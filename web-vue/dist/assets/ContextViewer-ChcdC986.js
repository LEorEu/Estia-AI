import{d as z,u as K,r as b,e as q,w as L,c as i,s as g,a as e,g as d,A as G,H as J,I as O,t as o,F as f,x as h,h as _,D as Q,v as R,o as a,n as X}from"./index-CqbccW_d.js";import{u as Y,w as j}from"./websocket-C78cLVHX.js";import{D as Z}from"./DashboardHeader-D_eb9y5d.js";import{r as ee}from"./EyeIcon-DwJcUS2v.js";import{r as k}from"./CheckIcon-A7RKCyXW.js";const te={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},se={class:"container mx-auto px-4 py-6"},oe={class:"mb-6"},le={class:"card p-4"},ie={class:"flex items-center space-x-4"},ae={class:"flex-1"},re={class:"flex space-x-2 pt-6"},ne=["disabled"],de={key:0},ce={key:1},ue=["disabled"],me={key:0,class:"mt-2 text-sm text-red-600"},xe={key:0,class:"space-y-6"},ve={class:"card"},ge={class:"border-b border-gray-200"},pe={class:"-mb-px flex space-x-8"},_e=["onClick"],ye={class:"p-6"},be={key:0,class:"space-y-4"},fe={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},he={class:"space-y-4"},we={class:"p-3 bg-gray-50 rounded-md border"},ke={class:"flex flex-wrap gap-2"},Ce={key:0,class:"text-gray-500 text-sm"},De={class:"space-y-4"},$e={class:"grid grid-cols-2 gap-4"},je={class:"p-3 bg-green-50 rounded-md"},Se={class:"text-lg font-semibold text-green-600"},Ve={class:"p-3 bg-blue-50 rounded-md"},Fe={class:"text-lg font-semibold text-blue-600"},Ie={key:1,class:"space-y-4"},Te={class:"space-y-6"},We={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ae={class:"p-4 bg-blue-50 rounded-lg"},Pe={class:"text-2xl font-bold text-blue-600"},Be={class:"p-4 bg-green-50 rounded-lg"},Ee={class:"text-2xl font-bold text-green-600"},He={class:"p-4 bg-purple-50 rounded-lg"},Ne={class:"text-2xl font-bold text-purple-600"},Me={class:"space-y-3"},Ue={class:"flex justify-between items-start mb-2"},ze={class:"text-sm font-medium text-gray-700"},Ke={class:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full"},qe={class:"text-gray-600 text-sm"},Le={key:0,class:"text-center py-8 text-gray-500"},Ge={key:0},Je={class:"p-4 bg-gray-50 rounded-lg"},Oe={class:"grid grid-cols-2 gap-4 mb-4"},Qe={class:"ml-2 font-medium"},Re={class:"ml-2 font-medium"},Xe={key:0,class:"space-y-2"},Ye={key:2,class:"space-y-4"},Ze={class:"space-y-6"},et={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},tt={class:"p-4 bg-yellow-50 rounded-lg"},st={class:"text-2xl font-bold text-yellow-600"},ot={class:"p-4 bg-indigo-50 rounded-lg"},lt={class:"text-2xl font-bold text-indigo-600"},it={class:"space-y-3"},at={class:"flex justify-between items-start mb-2"},rt={class:"text-sm font-medium text-gray-700"},nt={class:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full"},dt={class:"text-gray-600 text-sm"},ct={key:0,class:"text-center py-8 text-gray-500"},ut={key:3,class:"space-y-4"},mt={class:"space-y-6"},xt={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},vt={class:"p-3 bg-red-50 rounded-lg"},gt={class:"text-lg font-bold text-red-600"},pt={class:"p-3 bg-orange-50 rounded-lg"},_t={class:"text-lg font-bold text-orange-600"},yt={class:"p-3 bg-teal-50 rounded-lg"},bt={class:"text-lg font-bold text-teal-600"},ft={class:"p-3 bg-pink-50 rounded-lg"},ht={class:"text-lg font-bold text-pink-600"},wt={class:"space-y-4"},kt={class:"p-3 bg-gray-50 rounded-md border text-sm font-mono"},Ct={class:"p-3 bg-blue-50 rounded-md border max-h-40 overflow-y-auto"},Dt={key:0,class:"text-sm text-gray-500"},$t={class:"p-3 bg-yellow-50 rounded-md border text-sm"},jt={class:"p-3 bg-green-50 rounded-md border text-sm font-medium"},St={class:"p-4 bg-gray-50 rounded-md border max-h-96 overflow-y-auto"},Vt={class:"text-sm text-gray-700 whitespace-pre-wrap"},Ft={key:1,class:"text-center py-12"},It={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Tt={class:"flex min-h-full items-center justify-center p-4"},Wt={class:"relative w-full max-w-4xl bg-white rounded-xl shadow-2xl"},At={class:"p-6"},Pt={class:"flex items-center justify-between mb-4"},Bt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Et={class:"space-y-4"},Ht={class:"space-y-2 text-sm text-gray-600"},Nt={class:"flex items-center space-x-2"},Mt={class:"flex items-center space-x-2"},Ut={class:"flex items-center space-x-2"},zt={class:"flex items-center space-x-2"},Kt={class:"flex items-center space-x-2"},E="http://localhost:5000/api",Rt=z({__name:"ContextViewer",setup(qt){const p=K(),{connect:H,isConnected:N}=Y(),v=b(""),s=b(null),m=b(!1),x=b(""),y=b("preprocessing"),$=b(!1),M=[{id:"preprocessing",name:"预处理"},{id:"retrieval",name:"记忆检索"},{id:"history",name:"历史聚合"},{id:"final",name:"最终上下文"}],C=l=>!l&&l!==0?"未知":l<.001?"<1ms":l<1?`${(l*1e3).toFixed(1)}ms`:`${l.toFixed(3)}s`,S=async()=>{if(!v.value.trim()){x.value="请输入会话ID";return}m.value=!0,x.value="";try{const l=await fetch(`${E}/session/${v.value}/context`);if(!l.ok){const n=await l.json();throw new Error(n.error||`HTTP ${l.status}`)}const t=await l.json();s.value=t,p.add({type:"success",title:"上下文加载成功",message:`已加载会话 ${v.value} 的上下文数据`})}catch(l){x.value=l.message||"加载失败",s.value=null,p.add({type:"error",title:"加载失败",message:x.value})}finally{m.value=!1}},U=async()=>{var l,t;m.value=!0,x.value="";try{if(N()){j.subscribeContext(),j.on("context_status_update",V),p.add({type:"info",title:"已启用实时上下文监控",message:"通过WebSocket获取实时上下文更新"}),m.value=!1;return}const n=await fetch(`${E}/current_context`);if(!n.ok){const D=await n.json();throw new Error(D.error||`HTTP ${n.status}`)}const u=await n.json();if(!u.active){p.add({type:"info",title:"暂无活跃上下文",message:u.message||"当前没有正在处理的上下文构建过程"}),s.value=null;return}s.value={session_id:u.session_id,timestamp:u.timestamp,preprocessing:((l=u.partial_context)==null?void 0:l.preprocessing)||{},memory_retrieval:((t=u.partial_context)==null?void 0:t.memory_retrieval)||{},history_aggregation:{},final_context:{}},v.value=u.session_id,p.add({type:"success",title:"实时上下文加载成功",message:`当前正在处理会话: ${u.session_id}`})}catch(n){x.value=n.message||"加载实时上下文失败",s.value=null,p.add({type:"error",title:"加载失败",message:x.value})}finally{m.value=!1}},V=l=>{var t,n;if(console.log("📝 收到WebSocket上下文更新:",l),!l.active){s.value=null,p.add({type:"info",title:"上下文状态更新",message:l.message||"当前没有活跃的上下文构建过程"});return}s.value={session_id:l.session_id,timestamp:l.timestamp,preprocessing:((t=l.partial_context)==null?void 0:t.preprocessing)||{},memory_retrieval:((n=l.partial_context)==null?void 0:n.memory_retrieval)||{},history_aggregation:{},final_context:{}},v.value=l.session_id};return q(async()=>{console.log("ContextViewer mounted");try{await H(),console.log("✅ ContextViewer WebSocket连接成功")}catch(l){console.warn("⚠️ ContextViewer WebSocket连接失败:",l)}}),L(()=>{j.off("context_status_update",V),console.log("ContextViewer unmounted")}),(l,t)=>{var n,u,D,F,I,T,W,A,P,B;return a(),i("div",te,[g(Z),e("main",se,[t[35]||(t[35]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"上下文查看器"),e("p",{class:"text-gray-600"},"查看完整的对话上下文构建过程，了解系统如何处理用户输入")],-1)),e("div",oe,[e("div",le,[e("div",ie,[e("div",ae,[t[3]||(t[3]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"选择会话ID",-1)),G(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>v.value=r),onKeyup:O(S,["enter"]),type:"text",placeholder:"输入会话ID (例如: user123_20250123_140500)",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"},null,544),[[J,v.value]])]),e("div",re,[e("button",{onClick:S,disabled:!v.value||m.value,class:"px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[m.value?(a(),i("span",de,"加载中...")):(a(),i("span",ce,"查看上下文"))],8,ne),e("button",{onClick:U,disabled:m.value,class:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," 实时上下文 ",8,ue)])]),x.value?(a(),i("div",me,o(x.value),1)):d("",!0)])]),s.value?(a(),i("div",xe,[e("div",ve,[e("div",ge,[e("nav",pe,[(a(),i(f,null,h(M,r=>e("button",{key:r.id,onClick:c=>y.value=r.id,class:X(["py-2 px-1 border-b-2 font-medium text-sm",y.value===r.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},o(r.name),11,_e)),64))])]),e("div",ye,[y.value==="preprocessing"?(a(),i("div",be,[t[9]||(t[9]=e("h3",{class:"text-lg font-medium text-gray-900"},"用户输入预处理",-1)),e("div",fe,[e("div",he,[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"处理后的查询文本",-1)),e("div",we,o(s.value.preprocessing.query_processed||"暂无数据"),1)]),e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"提取的关键词",-1)),e("div",ke,[(a(!0),i(f,null,h(s.value.preprocessing.keywords_extracted,r=>(a(),i("span",{key:r,class:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full"},o(r),1))),128)),(n=s.value.preprocessing.keywords_extracted)!=null&&n.length?d("",!0):(a(),i("span",Ce," 暂无关键词 "))])])]),e("div",De,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"处理性能",-1)),e("div",$e,[e("div",je,[t[6]||(t[6]=e("div",{class:"text-sm text-gray-600"},"向量维度",-1)),e("div",Se,o(s.value.preprocessing.vector_dimension||0),1)]),e("div",Ve,[t[7]||(t[7]=e("div",{class:"text-sm text-gray-600"},"处理耗时",-1)),e("div",Fe,o(C(s.value.preprocessing.processing_time)),1)])])])])])])):d("",!0),y.value==="retrieval"?(a(),i("div",Ie,[t[17]||(t[17]=e("h3",{class:"text-lg font-medium text-gray-900"},"记忆检索结果",-1)),e("div",Te,[e("div",We,[e("div",Ae,[t[10]||(t[10]=e("div",{class:"text-sm text-gray-600"},"检索数量",-1)),e("div",Pe,o(s.value.memory_retrieval.retrieval_count||0),1)]),e("div",Be,[t[11]||(t[11]=e("div",{class:"text-sm text-gray-600"},"平均相似度",-1)),e("div",Ee,o((s.value.memory_retrieval.avg_similarity*100).toFixed(1))+"% ",1)]),e("div",He,[t[12]||(t[12]=e("div",{class:"text-sm text-gray-600"},"搜索耗时",-1)),e("div",Ne,o(C(s.value.memory_retrieval.search_time)),1)])]),e("div",null,[t[13]||(t[13]=e("h4",{class:"font-medium text-gray-800 mb-3"},"检索到的记忆",-1)),e("div",Me,[(a(!0),i(f,null,h(s.value.memory_retrieval.retrieved_memories,(r,c)=>{var w;return a(),i("div",{key:c,class:"p-4 bg-white border border-gray-200 rounded-lg"},[e("div",Ue,[e("span",ze,"记忆 #"+o(c+1),1),e("span",Ke," 相似度: "+o(((((w=s.value.memory_retrieval.similarity_scores)==null?void 0:w[c])||0)*100).toFixed(1))+"% ",1)]),e("div",qe,o(r||"记忆内容不可用"),1)])}),128)),(u=s.value.memory_retrieval.retrieved_memories)!=null&&u.length?d("",!0):(a(),i("div",Le," 暂无检索到的记忆 "))])]),s.value.memory_retrieval.associations?(a(),i("div",Ge,[t[16]||(t[16]=e("h4",{class:"font-medium text-gray-800 mb-3"},"关联网络拓展",-1)),e("div",Je,[e("div",Oe,[e("div",null,[t[14]||(t[14]=e("span",{class:"text-sm text-gray-600"},"拓展数量:",-1)),e("span",Qe,o(s.value.memory_retrieval.associations.association_count||0),1)]),e("div",null,[t[15]||(t[15]=e("span",{class:"text-sm text-gray-600"},"平均强度:",-1)),e("span",Re,o((s.value.memory_retrieval.associations.association_strength*100).toFixed(1))+"%",1)])]),(D=s.value.memory_retrieval.associations.expanded_memories)!=null&&D.length?(a(),i("div",Xe,[(a(!0),i(f,null,h(s.value.memory_retrieval.associations.expanded_memories,(r,c)=>(a(),i("div",{key:c,class:"p-2 bg-white rounded border text-sm"},o(r),1))),128))])):d("",!0)])])):d("",!0)])])):d("",!0),y.value==="history"?(a(),i("div",Ye,[t[21]||(t[21]=e("h3",{class:"text-lg font-medium text-gray-900"},"历史对话聚合",-1)),e("div",Ze,[e("div",et,[e("div",tt,[t[18]||(t[18]=e("div",{class:"text-sm text-gray-600"},"历史对话数量",-1)),e("div",st,o(s.value.history_aggregation.dialogue_count||0),1)]),e("div",ot,[t[19]||(t[19]=e("div",{class:"text-sm text-gray-600"},"聚合耗时",-1)),e("div",lt,o(C(s.value.history_aggregation.aggregation_time)),1)])]),e("div",null,[t[20]||(t[20]=e("h4",{class:"font-medium text-gray-800 mb-3"},"相关历史对话",-1)),e("div",it,[(a(!0),i(f,null,h(s.value.history_aggregation.historical_dialogues,(r,c)=>{var w;return a(),i("div",{key:c,class:"p-4 bg-white border border-gray-200 rounded-lg"},[e("div",at,[e("span",rt,"对话 #"+o(c+1),1),e("span",nt," 相关度: "+o(((((w=s.value.history_aggregation.relevance_scores)==null?void 0:w[c])||0)*100).toFixed(1))+"% ",1)]),e("div",dt,o(r||"对话内容不可用"),1)])}),128)),(F=s.value.history_aggregation.historical_dialogues)!=null&&F.length?d("",!0):(a(),i("div",ct," 暂无相关历史对话 "))])])])])):d("",!0),y.value==="final"?(a(),i("div",ut,[t[32]||(t[32]=e("h3",{class:"text-lg font-medium text-gray-900"},"最终上下文构建",-1)),e("div",mt,[e("div",xt,[e("div",vt,[t[22]||(t[22]=e("div",{class:"text-xs text-gray-600"},"上下文长度",-1)),e("div",gt,o(s.value.final_context.context_length||0),1)]),e("div",pt,[t[23]||(t[23]=e("div",{class:"text-xs text-gray-600"},"Token数量",-1)),e("div",_t,o(s.value.final_context.token_count||0),1)]),e("div",yt,[t[24]||(t[24]=e("div",{class:"text-xs text-gray-600"},"记忆数量",-1)),e("div",bt,o(s.value.final_context.memory_count||0),1)]),e("div",ft,[t[25]||(t[25]=e("div",{class:"text-xs text-gray-600"},"构建耗时",-1)),e("div",ht,o(C(s.value.final_context.build_time)),1)])]),e("div",null,[t[30]||(t[30]=e("h4",{class:"font-medium text-gray-800 mb-3"},"上下文结构",-1)),e("div",wt,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"系统提示词",-1)),e("div",kt,o(((I=s.value.final_context.context_structure)==null?void 0:I.system_prompt)||"暂无系统提示词"),1)]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"格式化记忆",-1)),e("div",Ct,[(a(!0),i(f,null,h((T=s.value.final_context.context_structure)==null?void 0:T.retrieved_memories,(r,c)=>(a(),i("div",{key:c,class:"text-sm mb-2 pb-2 border-b border-blue-200 last:border-b-0"},o(r),1))),128)),(A=(W=s.value.final_context.context_structure)==null?void 0:W.retrieved_memories)!=null&&A.length?d("",!0):(a(),i("div",Dt," 暂无格式化记忆 "))])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"历史上下文",-1)),e("div",$t,o(((P=s.value.final_context.context_structure)==null?void 0:P.historical_context)||"暂无历史上下文"),1)]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"用户输入",-1)),e("div",jt,o(((B=s.value.final_context.context_structure)==null?void 0:B.user_input)||"暂无用户输入"),1)])])]),e("div",null,[t[31]||(t[31]=e("h4",{class:"font-medium text-gray-800 mb-3"},"完整上下文内容",-1)),e("div",St,[e("pre",Vt,o(s.value.final_context.complete_context||"暂无完整上下文"),1)])])])])):d("",!0)])])])):m.value?d("",!0):(a(),i("div",Ft,[g(_(ee),{class:"w-16 h-16 mx-auto mb-4 text-gray-400"}),t[33]||(t[33]=e("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"选择一个会话查看上下文",-1)),t[34]||(t[34]=e("p",{class:"text-gray-600 mb-6"},' 输入会话ID或点击"实时上下文"查看当前正在处理的上下文构建过程 ',-1))]))]),$.value?(a(),i("div",It,[e("div",{class:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:t[1]||(t[1]=r=>$.value=!1)}),e("div",Tt,[e("div",Wt,[e("div",At,[e("div",Pt,[t[36]||(t[36]=e("h3",{class:"text-lg font-semibold text-gray-900"},"上下文查看器 - 功能预览",-1)),e("button",{onClick:t[2]||(t[2]=r=>$.value=!1),class:"text-gray-400 hover:text-gray-600"},[g(_(Q),{class:"w-6 h-6"})])]),e("div",Bt,[e("div",Et,[t[42]||(t[42]=e("h4",{class:"font-medium text-gray-800"},"核心功能",-1)),e("ul",Ht,[e("li",Nt,[g(_(k),{class:"w-4 h-4 text-green-500"}),t[37]||(t[37]=e("span",null,"用户输入预处理展示",-1))]),e("li",Mt,[g(_(k),{class:"w-4 h-4 text-green-500"}),t[38]||(t[38]=e("span",null,"记忆检索结果详情",-1))]),e("li",Ut,[g(_(k),{class:"w-4 h-4 text-green-500"}),t[39]||(t[39]=e("span",null,"关联网络拓展展示",-1))]),e("li",zt,[g(_(k),{class:"w-4 h-4 text-green-500"}),t[40]||(t[40]=e("span",null,"历史对话聚合",-1))]),e("li",Kt,[g(_(k),{class:"w-4 h-4 text-green-500"}),t[41]||(t[41]=e("span",null,"最终上下文构建",-1))])])]),t[43]||(t[43]=R('<div class="space-y-4"><h4 class="font-medium text-gray-800">预计开发时间</h4><div class="text-sm text-gray-600 space-y-2"><div class="flex justify-between"><span>后端API扩展</span><span>2-3天</span></div><div class="flex justify-between"><span>前端组件开发</span><span>2-3天</span></div><div class="flex justify-between"><span>数据可视化</span><span>1-2天</span></div><div class="flex justify-between border-t pt-2 font-medium"><span>总计</span><span>5-8天</span></div></div></div>',1))])])])])])):d("",!0)])}}});export{Rt as default};
//# sourceMappingURL=ContextViewer-ChcdC986.js.map
