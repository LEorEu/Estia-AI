import{c as o,a as e,o as l,d as R,u as U,r as g,e as Z,w as G,s as d,g as f,n as r,t as n,m as L,h as u,F as M,x as D,D as J,v as K,k as W}from"./index-DI6LqWAj.js";import{u as O,w}from"./websocket-okXG6Uhr.js";import{D as Q,b as B}from"./DashboardHeader-2Yh9rj3a.js";import{r as y}from"./CheckIcon-DVB0MRrT.js";function X(A,_){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function Y(A,_){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}const ee={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},te={class:"container mx-auto px-4 py-6"},se={class:"mb-6"},ae={class:"card p-4"},ie={class:"flex items-center justify-between"},ne={class:"flex items-center space-x-4"},oe={class:"flex items-center space-x-2"},le={class:"text-sm font-medium"},re={key:0,class:"text-sm text-gray-600"},de={class:"flex space-x-2"},ue=["disabled"],ce={key:0,class:"mt-2 text-sm text-red-600"},_e={key:0,class:"space-y-6"},ve={class:"card p-6"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ge={class:"text-center"},pe={class:"mb-3"},xe={class:"mx-auto w-20 h-20 rounded-full border-4 border-gray-200 flex items-center justify-center relative"},fe={class:"bg-white rounded-full w-14 h-14 flex items-center justify-center z-10"},ye={class:"mt-2"},be={class:"text-center"},he={class:"mb-3"},we={class:"mx-auto w-20 h-20 rounded-full border-4 border-gray-200 flex items-center justify-center relative"},ke={class:"bg-white rounded-full w-14 h-14 flex items-center justify-center z-10"},Se={class:"mt-2"},ze={class:"text-center"},je={class:"mb-3"},Pe={class:"mx-auto w-20 h-20 rounded-full border-4 border-gray-200 flex items-center justify-center relative"},Ce={class:"bg-white rounded-full w-14 h-14 flex items-center justify-center z-10"},$e={class:"mt-2"},Le={key:0,class:"card p-4 bg-blue-50 border-blue-200"},Me={class:"flex items-center space-x-3"},De={class:"ml-2 text-blue-700"},Ae={class:"card p-6"},Ve={class:"space-y-4"},We={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Be={class:"flex items-center justify-between mb-2"},Fe={class:"text-sm font-medium"},Ie={class:"text-xs text-gray-600"},Ne={key:0},Te={key:1},qe={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},He={class:"flex items-center justify-between mb-2"},Ee={class:"text-sm font-medium"},Re={class:"text-xs text-gray-600"},Ue={key:0},Ze={key:1},Ge={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Je={class:"flex items-center justify-between mb-2"},Ke={class:"text-sm font-medium"},Oe={class:"text-xs text-gray-600"},Qe={key:0},Xe={key:1},Ye={key:1,class:"text-center py-12"},et={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},tt={class:"flex min-h-full items-center justify-center p-4"},st={class:"relative w-full max-w-4xl bg-white rounded-xl shadow-2xl"},at={class:"p-6"},it={class:"flex items-center justify-between mb-4"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ot={class:"space-y-4"},lt={class:"space-y-2 text-sm text-gray-600"},rt={class:"flex items-center space-x-2"},dt={class:"flex items-center space-x-2"},ut={class:"flex items-center space-x-2"},ct={class:"flex items-center space-x-2"},_t={class:"flex items-center space-x-2"},vt="http://localhost:5000/api",ft=R({__name:"PipelineViewer",setup(A){const _=U(),{connect:V,isConnected:F}=O(),i=g(null),v=g(!1),p=g(""),c=g(!1),m=g(null),k=g(!1),I=[{id:"step_1_database_initialization",name:"数据库初始化"},{id:"step_2_component_initialization",name:"组件初始化"},{id:"step_3_async_evaluator_initialization",name:"异步评估器初始化"}],N=[{id:"step_4_unified_cache_vectorization",name:"统一缓存向量化"},{id:"step_5_faiss_vector_retrieval",name:"FAISS向量检索"},{id:"step_6_association_network_expansion",name:"关联网络拓展"},{id:"step_7_history_dialogue_aggregation",name:"历史对话聚合"},{id:"step_8_weight_ranking_deduplication",name:"权重排序去重"},{id:"step_9_final_context_assembly",name:"最终上下文构建"}],T=[{id:"step_10_llm_response_generation",name:"LLM响应生成"},{id:"step_11_immediate_dialogue_storage",name:"即时对话存储"},{id:"step_12_async_llm_evaluation",name:"异步LLM评估"},{id:"step_13_save_evaluation_results",name:"保存评估结果"},{id:"step_14_auto_association_creation",name:"自动关联创建"}],q=a=>({step_1_database_initialization:"数据库初始化",step_2_component_initialization:"组件初始化",step_3_async_evaluator_initialization:"异步评估器初始化",step_4_unified_cache_vectorization:"统一缓存向量化",step_5_faiss_vector_retrieval:"FAISS向量检索",step_6_association_network_expansion:"关联网络拓展",step_7_history_dialogue_aggregation:"历史对话聚合",step_8_weight_ranking_deduplication:"权重排序去重",step_9_final_context_assembly:"最终上下文构建",step_10_llm_response_generation:"LLM响应生成",step_11_immediate_dialogue_storage:"即时对话存储",step_12_async_llm_evaluation:"异步LLM评估",step_13_save_evaluation_results:"保存评估结果",step_14_auto_association_creation:"自动关联创建"})[a]||a,b=a=>({initialization:"#10b981",query_enhancement:"#3b82f6",storage_evaluation:"#8b5cf6"})[a]||"#6b7280",S=a=>({completed:"bg-green-100 text-green-800",running:"bg-blue-100 text-blue-800",idle:"bg-gray-100 text-gray-800",failed:"bg-red-100 text-red-800"})[a]||"bg-gray-100 text-gray-800",z=a=>({completed:"已完成",running:"运行中",idle:"空闲",failed:"失败"})[a]||a,j=a=>{var s;if(!((s=i.value)!=null&&s.current_step))return"bg-gray-50 border-gray-200";if(i.value.current_step===a)return"bg-blue-50 border-blue-300 shadow-md";const t=i.value.step_status[a];return t&&t.success_rate>.8?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"},P=a=>{var s,x;if(((s=i.value)==null?void 0:s.current_step)===a)return"text-blue-600";const t=(x=i.value)==null?void 0:x.step_status[a];return t&&t.success_rate>.8?"text-green-600":"text-gray-400"},C=a=>{var s,x;if(((s=i.value)==null?void 0:s.current_step)===a)return"⚡";const t=(x=i.value)==null?void 0:x.step_status[a];return t&&t.success_rate>.8?"✅":"⭕"},h=async()=>{v.value=!0,p.value="";try{const a=await fetch(`${vt}/pipeline/status`);if(!a.ok){const s=await a.json();throw new Error(s.error||`HTTP ${a.status}`)}const t=await a.json();i.value=t,c.value||_.add({type:"success",title:"流程数据更新",message:`活跃会话: ${t.active_sessions}`})}catch(a){p.value=a.message||"加载失败",i.value=null,c.value||_.add({type:"error",title:"加载失败",message:p.value})}finally{v.value=!1}},H=async()=>{if(c.value=!c.value,c.value)try{F()||await V(),w.subscribePipeline(),w.on("pipeline_status_update",$),_.add({type:"success",title:"WebSocket实时更新已开启",message:"已连接到实时监控服务"})}catch(a){console.warn("WebSocket连接失败，降级到轮询模式:",a),c.value=!1,E()}else w.off("pipeline_status_update",$),m.value&&(clearInterval(m.value),m.value=null),_.add({type:"info",title:"实时更新已关闭",message:"已停止自动更新"})},E=()=>{m.value=setInterval(h,3e3),_.add({type:"info",title:"轮询模式已启动",message:"每3秒自动更新流程数据"})},$=a=>{i.value=a,console.log("📊 收到WebSocket流程状态更新:",a)};return Z(async()=>{console.log("PipelineViewer mounted"),await h();try{await V(),console.log("✅ WebSocket连接成功")}catch(a){console.warn("⚠️ WebSocket连接失败，将使用HTTP API:",a)}}),G(()=>{m.value&&clearInterval(m.value),w.off("pipeline_status_update",$),console.log("PipelineViewer unmounted")}),(a,t)=>(l(),o("div",ee,[d(Q),e("main",te,[t[17]||(t[17]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"15步流程可视化"),e("p",{class:"text-gray-600"},"实时监控记忆处理流程，了解每个步骤的执行状态和性能")],-1)),e("div",se,[e("div",ae,[e("div",ie,[e("div",ne,[e("div",oe,[e("div",{class:r(["w-3 h-3 rounded-full",v.value?"bg-yellow-500 animate-pulse":i.value?"bg-green-500":"bg-red-500"])},null,2),e("span",le,n(v.value?"加载中...":i.value?"数据已连接":"连接失败"),1)]),i.value?(l(),o("div",re," 活跃会话: "+n(i.value.active_sessions),1)):f("",!0)]),e("div",de,[e("button",{onClick:h,disabled:v.value,class:"px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 disabled:opacity-50 transition-colors"},n(v.value?"刷新中...":"刷新数据"),9,ue),e("button",{onClick:H,class:r(["px-4 py-2 rounded-md transition-colors",c.value?"bg-green-500 hover:bg-green-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"])},n(c.value?"自动刷新: 开":"自动刷新: 关"),3)])]),p.value?(l(),o("div",ce,n(p.value),1)):f("",!0)])]),i.value?(l(),o("div",_e,[e("div",ve,[t[8]||(t[8]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"三阶段流程概览",-1)),e("div",me,[e("div",ge,[e("div",pe,[e("div",xe,[e("div",{class:r(["absolute inset-0 rounded-full transition-all duration-500",b("initialization")]),style:L({background:`conic-gradient(${b("initialization")} ${i.value.phase_status.initialization.progress}%, transparent 0%)`})},null,6),e("div",fe,[d(u(B),{class:"w-6 h-6 text-gray-600"})])])]),t[2]||(t[2]=e("h4",{class:"font-medium text-gray-800"},"系统初始化",-1)),t[3]||(t[3]=e("p",{class:"text-sm text-gray-600"},"Steps 1-3",-1)),e("div",ye,[e("span",{class:r(["px-2 py-1 text-xs rounded-full",S(i.value.phase_status.initialization.status)])},n(z(i.value.phase_status.initialization.status)),3)])]),e("div",be,[e("div",he,[e("div",we,[e("div",{class:r(["absolute inset-0 rounded-full transition-all duration-500"]),style:L({background:`conic-gradient(${b("query_enhancement")} ${i.value.phase_status.query_enhancement.progress}%, transparent 0%)`})},null,4),e("div",ke,[d(u(Y),{class:"w-6 h-6 text-gray-600"})])])]),t[4]||(t[4]=e("h4",{class:"font-medium text-gray-800"},"实时记忆增强",-1)),t[5]||(t[5]=e("p",{class:"text-sm text-gray-600"},"Steps 4-9",-1)),e("div",Se,[e("span",{class:r(["px-2 py-1 text-xs rounded-full",S(i.value.phase_status.query_enhancement.status)])},n(z(i.value.phase_status.query_enhancement.status)),3)])]),e("div",ze,[e("div",je,[e("div",Pe,[e("div",{class:r(["absolute inset-0 rounded-full transition-all duration-500"]),style:L({background:`conic-gradient(${b("storage_evaluation")} ${i.value.phase_status.storage_evaluation.progress}%, transparent 0%)`})},null,4),e("div",Ce,[d(u(X),{class:"w-6 h-6 text-gray-600"})])])]),t[6]||(t[6]=e("h4",{class:"font-medium text-gray-800"},"存储与评估",-1)),t[7]||(t[7]=e("p",{class:"text-sm text-gray-600"},"Steps 10-15",-1)),e("div",$e,[e("span",{class:r(["px-2 py-1 text-xs rounded-full",S(i.value.phase_status.storage_evaluation.status)])},n(z(i.value.phase_status.storage_evaluation.status)),3)])])])]),i.value.current_step?(l(),o("div",Le,[e("div",Me,[t[10]||(t[10]=e("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"},null,-1)),e("div",null,[t[9]||(t[9]=e("span",{class:"font-medium text-blue-800"},"当前执行步骤:",-1)),e("span",De,n(q(i.value.current_step)),1)])])])):f("",!0),e("div",Ae,[t[14]||(t[14]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"详细步骤状态",-1)),e("div",Ve,[e("div",null,[t[11]||(t[11]=e("h4",{class:"font-medium text-gray-800 mb-3"},"阶段一: 系统初始化 (Steps 1-3)",-1)),e("div",We,[(l(),o(M,null,D(I,s=>e("div",{key:s.id,class:r(["p-3 rounded-lg border",j(s.id)])},[e("div",Be,[e("span",Fe,n(s.name),1),e("div",{class:r(P(s.id))},n(C(s.id)),3)]),e("div",Ie,[i.value.step_status[s.id]?(l(),o("div",Ne," 平均耗时: "+n(i.value.step_status[s.id].avg_duration)+"s ",1)):(l(),o("div",Te,"暂无数据"))])],2)),64))])]),e("div",null,[t[12]||(t[12]=e("h4",{class:"font-medium text-gray-800 mb-3"},"阶段二: 实时记忆增强 (Steps 4-9)",-1)),e("div",qe,[(l(),o(M,null,D(N,s=>e("div",{key:s.id,class:r(["p-3 rounded-lg border",j(s.id)])},[e("div",He,[e("span",Ee,n(s.name),1),e("div",{class:r(P(s.id))},n(C(s.id)),3)]),e("div",Re,[i.value.step_status[s.id]?(l(),o("div",Ue," 平均耗时: "+n(i.value.step_status[s.id].avg_duration)+"s ",1)):(l(),o("div",Ze,"暂无数据"))])],2)),64))])]),e("div",null,[t[13]||(t[13]=e("h4",{class:"font-medium text-gray-800 mb-3"},"阶段三: 存储与评估 (Steps 10-15)",-1)),e("div",Ge,[(l(),o(M,null,D(T,s=>e("div",{key:s.id,class:r(["p-3 rounded-lg border",j(s.id)])},[e("div",Je,[e("span",Ke,n(s.name),1),e("div",{class:r(P(s.id))},n(C(s.id)),3)]),e("div",Oe,[i.value.step_status[s.id]?(l(),o("div",Qe," 平均耗时: "+n(i.value.step_status[s.id].avg_duration)+"s ",1)):(l(),o("div",Xe,"暂无数据"))])],2)),64))])])])])])):v.value?f("",!0):(l(),o("div",Ye,[d(u(B),{class:"w-16 h-16 mx-auto mb-4 text-gray-400"}),t[15]||(t[15]=e("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"无法获取流程数据",-1)),t[16]||(t[16]=e("p",{class:"text-gray-600 mb-6"}," 请确保后端服务正在运行，或点击刷新数据重试 ",-1)),e("button",{onClick:h,class:"px-6 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors"}," 重试 ")]))]),k.value?(l(),o("div",et,[e("div",{class:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:t[0]||(t[0]=s=>k.value=!1)}),e("div",tt,[e("div",st,[e("div",at,[e("div",it,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-900"},"15步流程可视化 - 功能预览",-1)),e("button",{onClick:t[1]||(t[1]=s=>k.value=!1),class:"text-gray-400 hover:text-gray-600"},[d(u(J),{class:"w-6 h-6"})])]),e("div",nt,[e("div",ot,[t[24]||(t[24]=e("h4",{class:"font-medium text-gray-800"},"核心功能",-1)),e("ul",lt,[e("li",rt,[d(u(y),{class:"w-4 h-4 text-green-500"}),t[19]||(t[19]=e("span",null,"三阶段进度环形图",-1))]),e("li",dt,[d(u(y),{class:"w-4 h-4 text-green-500"}),t[20]||(t[20]=e("span",null,"步骤状态实时指示器",-1))]),e("li",ut,[d(u(y),{class:"w-4 h-4 text-green-500"}),t[21]||(t[21]=e("span",null,"性能指标实时监控",-1))]),e("li",ct,[d(u(y),{class:"w-4 h-4 text-green-500"}),t[22]||(t[22]=e("span",null,"瓶颈自动识别",-1))]),e("li",_t,[d(u(y),{class:"w-4 h-4 text-green-500"}),t[23]||(t[23]=e("span",null,"流程执行动画",-1))])])]),t[25]||(t[25]=K('<div class="space-y-4"><h4 class="font-medium text-gray-800">15步流程概览</h4><div class="text-xs text-gray-600 space-y-1"><div class="font-medium text-gray-700">Phase 1: 系统初始化 (1-3步)</div><div>• 数据库初始化</div><div>• 组件初始化</div><div>• 异步评估器初始化</div><div class="font-medium text-gray-700 mt-2">Phase 2: 实时增强 (4-9步)</div><div>• 统一缓存向量化</div><div>• FAISS向量检索</div><div>• 关联网络拓展</div><div class="font-medium text-gray-700 mt-2">Phase 3: 存储评估 (10-15步)</div><div>• LLM响应生成</div><div>• 异步评估处理</div><div>• 关联创建清理</div></div></div>',1))]),t[26]||(t[26]=e("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg"},[e("div",{class:"text-sm text-blue-800"},[e("strong",null,"预计开发时间："),W(" 3-4天 "),e("br"),e("strong",null,"技术难点："),W(" 实时数据流处理、SVG动画效果、性能优化 ")])],-1))])])])])):f("",!0)]))}});export{ft as default};
//# sourceMappingURL=PipelineViewer-DWhKdZeO.js.map
